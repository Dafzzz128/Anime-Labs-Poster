<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Poster Generator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');
        
        :root {
            --primary-purple: #8A2BE2; /* Biru Ungu */
            --dark-blue: #0A0A2A;
            --gradient-start: #3f0071;
            --gradient-end: #000000;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Mencegah scroll horizontal dari animasi */
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--gradient-start);
            background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
            position: relative;
            z-index: 1; /* Pastikan konten di atas animasi */
        }

        /* --- Animasi Gelombang Warna-warni --- */
        .waves {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            filter: blur(20px) contrast(150%); /* Efek blur dan kontras untuk gelombang */
        }

        .wave {
            position: absolute;
            border-radius: 50%;
            background: rgba(var(--primary-purple), 0.5); /* Warna dasar ungu */
            animation: wave-motion 20s infinite linear;
            opacity: 0.7;
            transform: translate(-50%, -50%);
        }

        .wave:nth-child(1) { width: 500px; height: 500px; top: 10%; left: 20%; animation-duration: 18s; background: rgba(255, 0, 150, 0.4); } /* Merah muda */
        .wave:nth-child(2) { width: 700px; height: 700px; top: 60%; left: 80%; animation-duration: 25s; background: rgba(0, 200, 255, 0.4); } /* Biru muda */
        .wave:nth-child(3) { width: 600px; height: 600px; top: 30%; left: 50%; animation-duration: 22s; background: rgba(150, 255, 0, 0.4); } /* Hijau terang */
        .wave:nth-child(4) { width: 800px; height: 800px; top: 80%; left: 30%; animation-duration: 28s; background: rgba(255, 100, 0, 0.4); } /* Oranye */
        .wave:nth-child(5) { width: 400px; height: 400px; top: 50%; left: 10%; animation-duration: 20s; background: rgba(200, 0, 255, 0.4); } /* Ungu terang */


        @keyframes wave-motion {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0.7; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.4; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0.7; }
        }
        /* --- Akhir Animasi Gelombang --- */

        /* --- Konten utama --- */
        h1 { font-weight: 900; margin-top: 40px; margin-bottom: 20px; text-shadow: 0 4px 10px rgba(0,0,0,0.5); position: relative; z-index: 1;}
        p { margin-bottom: 30px; opacity: 0.8; position: relative; z-index: 1;}

        .search-section { width: 100%; max-width: 900px; display: flex; gap: 10px; margin-bottom: 35px; position: relative; z-index: 1;}
        input[type="text"] { flex: 1; padding: 15px; border-radius: 12px; border: none; outline: none; font-size: 16px; background: rgba(255,255,255,0.1); color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        input[type="text"]::placeholder { color: rgba(255,255,255,0.6); }

        .btn { padding: 12px 25px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; color: white; }
        .btn-search { background: var(--primary-purple); }
        .btn-download { background: #000; width: 100%; margin-top: 15px; font-size: 16px; }

        .container { display: flex; gap: 40px; flex-wrap: wrap; justify-content: center; width: 100%; max-width: 1200px; position: relative; z-index: 1;}
        .editor-panel { background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 25px; border-radius: 20px; width: 350px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); height: fit-content; border: 1px solid rgba(255,255,255,0.1); }
        .field { margin-bottom: 12px; }
        label { display: block; font-size: 11px; font-weight: bold; color: rgba(255,255,255,0.7); text-transform: uppercase; margin-bottom: 4px; }
        textarea, input { width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; box-sizing: border-box; font-family: inherit; font-size: 14px; background: rgba(0,0,0,0.2); color: white; }
        textarea:focus, input:focus { border-color: var(--primary-purple); background: rgba(0,0,0,0.3); }

        canvas { background: #E9E9E9; border-radius: 4px; box-shadow: 0 30px 60px rgba(0,0,0,0.5); max-width: 100%; height: auto; width: 450px; }
    </style>
</head>
<body>

    <div class="waves">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
    </div>

    <h1>✨ ANIME POSTER GENERATOR ✨</h1>
    <p>Cari anime favoritmu dan buat poster epik secara instan!</p>

    <div class="search-section">
        <input type="text" id="searchInp" placeholder="Cari anime... (Contoh: Spy x Family)">
        <button class="btn btn-search" onclick="searchAnime()">CARI ANIME</button>
    </div>

    <div class="container">
        <div class="editor-panel">
            <div class="field"><label>Judul Utama</label><textarea id="titleInp" rows="2">ANIME TITLE</textarea></div>
            <div class="field"><label>Tahun Rilis</label><input type="text" id="yearInp" value="2024"></div>
            <div class="field"><label>Genre</label><input type="text" id="genreInp" value="Action, Adventure"></div>
            <div class="field"><label>Produced By</label><input type="text" id="prodByInp" value="Producer Name"></div>
            <div class="field"><label>Directed By</label><input type="text" id="dirInp" value="Director Name"></div>
            <div class="field"><label>Studios</label><input type="text" id="studioInp" value="Studio Name"></div>
            <div class="field"><label>Starring</label><textarea id="starInp" rows="3">Main Voice Cast</textarea></div>
            <button class="btn btn-download" onclick="download()">UNDUH POSTER PNG</button>
        </div>

        <div class="preview-area">
            <canvas id="posterCanvas" width="1000"></canvas>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('posterCanvas');
        const ctx = canvas.getContext('2d');
        let userImg = new Image();
        userImg.crossOrigin = "anonymous";

        async function searchAnime() {
            const q = document.getElementById('searchInp').value;
            if(!q) return;
            const btn = document.querySelector('.btn-search');
            btn.innerText = "Mencari...";
            
            try {
                const res = await fetch(`https://api.jikan.moe/v4/anime?q=${q}&limit=1`);
                const json = await res.json();
                if(json.data[0]) {
                    const a = json.data[0];
                    document.getElementById('titleInp').value = a.title;
                    document.getElementById('yearInp').value = a.year || a.aired.prop.from.year || "";
                    document.getElementById('genreInp').value = a.genres.map(g=>g.name).join(', ');
                    document.getElementById('prodByInp').value = a.producers.slice(0,2).map(p=>p.name).join(', ') || "-";
                    document.getElementById('studioInp').value = a.studios.map(s=>s.name).join(', ');
                    
                    // Fetch Director
                    const staffRes = await fetch(`https://api.jikan.moe/v4/anime/${a.mal_id}/staff`);
                    const staffJson = await staffRes.json();
                    const director = staffJson.data.find(s => s.positions.includes("Director"));
                    document.getElementById('dirInp').value = director ? director.person.name : "-";

                    // Fetch Characters for Starring
                    const charRes = await fetch(`https://api.jikan.moe/v4/anime/${a.mal_id}/characters`);
                    const charJson = await charRes.json();
                    document.getElementById('starInp').value = charJson.data.slice(0, 5).map(c => c.character.name).join(', ');

                    userImg.src = a.images.jpg.large_image_url;
                    userImg.onload = draw;
                } else {
                    alert("Anime tidak ditemukan. Coba nama lain!");
                }
            } catch(e) { 
                console.error("Error fetching anime data:", e);
                alert("Gagal mengambil data. Pastikan nama anime benar atau coba lagi nanti.");
            }
            btn.innerText = "CARI ANIME";
        }

        function helperDrawText(text, x, y, maxWidth, lineHeight, font, isDrawing) {
            ctx.font = font;
            const words = text.split(' ');
            let line = '';
            let currentY = y;
            for (let n = 0; n < words.length; n++) {
                let test = line + words[n] + ' ';
                if (ctx.measureText(test).width > maxWidth && n > 0) {
                    if (isDrawing) ctx.fillText(line, x, currentY);
                    line = words[n] + ' ';
                    currentY += lineHeight;
                } else { line = test; }
            }
            if (isDrawing) ctx.fillText(line, x, currentY);
            return currentY + lineHeight;
        }

        function draw() {
            const margin = 60;
            const maxWidth = 880;

            // --- TAHAP 1: HITUNG TINGGI TOTAL ---
            let measureY = 980; // Titik mulai setelah gambar
            measureY = helperDrawText(document.getElementById('titleInp').value.toUpperCase(), margin, measureY, maxWidth, 95, "900 85px 'Montserrat'", false);
            measureY += 60; // Space Tahun
            
            // Hitung space Metadata
            measureY = helperDrawText(document.getElementById('genreInp').value.toUpperCase(), 220, measureY, 700, 38, "bold 22px 'Montserrat'", false);
            measureY = helperDrawText(document.getElementById('prodByInp').value.toUpperCase(), 220, measureY, 700, 38, "bold 22px 'Montserrat'", false);
            measureY = helperDrawText(document.getElementById('dirInp').value.toUpperCase(), 220, measureY, 700, 38, "bold 22px 'Montserrat'", false);
            measureY = helperDrawText(document.getElementById('studioInp').value.toUpperCase(), 220, measureY, 700, 38, "bold 22px 'Montserrat'", false);
            measureY = helperDrawText(document.getElementById('starInp').value.toUpperCase(), 220, measureY, 700, 38, "bold 22px 'Montserrat'", false);
            
            // Set Tinggi Canvas sesuai hitungan
            canvas.height = measureY + 120; // Tambah padding bawah

            // --- TAHAP 2: GAMBAR ULANG ---
            ctx.fillStyle = "#E9E9E9"; // Warna broken white canvas
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if(userImg.src) ctx.drawImage(userImg, margin, 60, 880, 850);

            ctx.fillStyle = "black";
            let drawY = 980;

            // Gambar Judul
            drawY = helperDrawText(document.getElementById('titleInp').value.toUpperCase(), margin, drawY, maxWidth, 95, "900 85px 'Montserrat'", true);

            // Gambar Tahun
            ctx.font = "400 35px 'Montserrat'"; // Sedikit tebal dari 300
            ctx.fillText(document.getElementById('yearInp').value, margin, drawY);
            drawY += 100;

            // Gambar Metadata
            const metadata = [
                {l: "genre:", v: document.getElementById('genreInp').value},
                {l: "produced by:", v: document.getElementById('prodByInp').value},
                {l: "directed by:", v: document.getElementById('dirInp').value},
                {l: "studios:", v: document.getElementById('studioInp').value},
                {l: "starring:", v: document.getElementById('starInp').value}
            ];

            metadata.forEach(item => {
                ctx.fillStyle = "#666"; ctx.font = "20px 'Montserrat'";
                ctx.fillText(item.l, margin, drawY);
                ctx.fillStyle = "black";
                drawY = helperDrawText(item.v.toUpperCase(), 220, drawY, 700, 38, "bold 20px 'Montserrat'", true) + 8;
            });

            // Tidak ada sinopsis lagi di sini.
        }

        document.querySelectorAll('input, textarea').forEach(el => el.oninput = draw);
        function download() {
            const link = document.createElement('a');
            link.download = 'anime-poster.png';
            link.href = canvas.toDataURL();
            link.click();
        }
        window.onload = draw;
    </script>
</body>
</html>
